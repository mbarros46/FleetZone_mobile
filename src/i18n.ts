// Minimal i18n helper used pelo app para notifica√ß√µes e pequenas strings
import AsyncStorage from '@react-native-async-storage/async-storage';

export type SupportedLang = 'pt' | 'es' | 'en';

const translations: Record<SupportedLang, Record<string, string>> = {
  pt: {
    error_label: 'Erro',
    success_label: 'Sucesso',
    info_label: 'Info',
    load_motos_fail: 'Falha ao carregar motos',
    delete_label: 'Excluir',
    delete_confirm: 'Confirmar exclus√£o desta moto?',
    cancel_label: 'Cancelar',
    delete_fail: 'Falha ao excluir a moto',
    not_found_label: 'Moto n√£o encontrada',
    not_found_message: 'Verifique a chave/placa digitada.',
    search_fail: 'N√£o foi poss√≠vel buscar a moto. Tente novamente.',
    load_moto_fail: 'Falha ao carregar moto',
    data_saved: 'Dados salvos!',
    save_fail: 'Falha ao salvar',
    edit_moto: 'Editar Moto',
    create_moto: 'Cadastrar Moto',
    fill_moto_data: 'Preencha os dados abaixo para adicionar a motocicleta na frota',
    moto_info: 'Informa√ß√µes da Moto',
    modelo_label: 'Modelo',
    placa_label: 'Placa',
    status_label: 'Status (opcional)',
    update_moto: 'Atualizar Moto',
    form_cleared: 'Os campos foram limpos. Voc√™ pode preencher novamente.',
    settings_title: 'Configura√ß√µes',
    settings_subtitle: 'Personalize a apar√™ncia e comportamento do app',
    language_label: 'Idioma do App',
    theme_label: 'Tema do App',
    appearance: 'Apar√™ncia',
    colors: 'Cores',
    save_changes: 'Salvar Altera√ß√µes',
    logout: 'Sair',
    register: 'Registrar',
    enter: 'Entrar',
    create_account: 'Criar Conta',
    fill_data: 'Preencha os dados para se cadastrar',
    email_label: 'Email',
    password_label: 'Senha',
    name_label: 'Nome Completo',
    confirm_password_label: 'Confirmar Senha',
    test_notification_title: 'Notifica√ß√£o de teste',
    test_notification_body: 'Ol√°! Esta √© uma notifica√ß√£o de teste em Portugu√™s.',
    register_success: 'Registrado para notifica√ß√µes com sucesso',
    register_fail: 'Falha ao registrar notifica√ß√µes',
  settings_saved: 'Configura√ß√µes salvas!',
  settings_save_fail: 'N√£o foi poss√≠vel salvar as configura√ß√µes',
  theme_changed_title: 'Tema Alterado',
  theme_changed_light: 'Tema claro aplicado com sucesso!',
  theme_changed_dark: 'Tema escuro aplicado com sucesso!',
  theme_changed_system: 'Tema autom√°tico ativado - segue o sistema!',
  colors_presets: 'Cores Predefinidas:',
  accent_color_label: 'Cor de Destaque',
  register_notifications: 'Registrar Notifica√ß√µes',
  push_token_registered: 'Token registrado',
  send_test_notification: 'Enviar Notifica√ß√£o de Teste',
  loading_moto_data: 'Carregando dados da moto‚Ä¶',
  plate_format_hint: 'Certifique-se de que a placa est√° no formato correto (ABC-1234)',
  placeholder_model_examples: 'Ex: Honda CG 160, Yamaha Fazer 250',
  placeholder_plate: 'ABC-1234',
  placeholder_status_examples: 'Dispon√≠vel, Em manuten√ß√£o...',
  theme_light: 'Claro',
  theme_dark: 'Escuro',
  theme_system: 'Sistema',
  language_selected_pt: 'Portugu√™s selecionado',
  language_selected_es: 'Espa√±ol seleccionado',
  logout_fail: 'Falha ao deslogar. Tente novamente.',
  test_notification_sent: 'Notifica√ß√£o enviada (verifique seu dispositivo)',
  clear_form: 'Limpar Formul√°rio',
  passwords_not_match: 'As senhas n√£o coincidem',
  password_too_short: 'A senha deve ter pelo menos 6 caracteres',
  invalid_email: 'Por favor, insira um email v√°lido',
  register_success_message: 'Cadastro realizado com sucesso!',
  already_have_account: 'J√° tem uma conta?',
  login_cta: 'Fa√ßa login',
  no_account: 'N√£o tem uma conta?',
  login_fail: 'Falha no login. Verifique suas credenciais.',
  search_title: 'Buscar Motocicleta',
  search_subtitle: 'Digite a placa para visualizar os detalhes',
  quick_search_title: 'üöÄ Busca R√°pida - Motos Dispon√≠veis:',
  moto_found_title: 'Moto Encontrada!',
  moto_loaded_success: 'carregada com sucesso.',
  search_by_plate: 'Consulta por Placa',
  placeholder_plate_search: 'Digite a placa (ABC-1234)',
  search_button: 'Buscar Motocicleta',
  reset_search_title: 'Busca Limpa',
  reset_search_message: 'Voc√™ pode fazer uma nova busca agora.',
  new_search_label: 'Nova Busca',
  label_plate: 'Placa',
  label_patio: 'P√°tio',
  label_entry_date: 'Data de Entrada',
  label_km: 'Quilometragem',
  label_next_maintenance: 'Pr√≥xima Manuten√ß√£o',
  notfound_message: "Esta tela n√£o existe.",
  go_home: 'Ir para in√≠cio',
    about_title: 'Sobre o App',
    about_commit_label: 'Hash do commit de refer√™ncia:',
    about_note: 'Valor buscado em app.json/package.json/COMMIT_HASH',
    // new keys added for axios-based motos screens
    'motos.created_success': 'Moto cadastrada com sucesso.',
    'motos.updated_success': 'Moto atualizada com sucesso.',
    'motos.delete_success': 'Moto removida com sucesso.',
    'motos.create_fail': 'Falha ao cadastrar a moto.',
    'motos.update_fail': 'Falha ao atualizar a moto.',
    'motos.delete_fail': 'Falha ao remover a moto.',
    'buttons.edit': 'Editar',
    'buttons.save': 'Salvar',
    'buttons.delete': 'Remover',
    'placeholders.modelo': 'Modelo da moto',
    'placeholders.placa': 'ABC-1234',
    'placeholders.patio': 'ID do p√°tio',
    'placeholders.km': 'Quilometragem',
    loading_label: 'Carregando...',
  },
  es: {
    error_label: 'Error',
    success_label: '√âxito',
    info_label: 'Info',
    load_motos_fail: 'Error al cargar motos',
    delete_label: 'Eliminar',
    delete_confirm: '¬øConfirmar la eliminaci√≥n de esta moto?',
    cancel_label: 'Cancelar',
    delete_fail: 'Error al eliminar la moto',
    not_found_label: 'Moto no encontrada',
    not_found_message: 'Verifique la clave/placa ingresada.',
    search_fail: 'No se pudo buscar la moto. Int√©ntalo de nuevo.',
    load_moto_fail: 'Error al cargar la moto',
    data_saved: '¬°Datos guardados!',
    save_fail: 'Error al guardar',
    edit_moto: 'Editar Moto',
    create_moto: 'Registrar Moto',
    fill_moto_data: 'Complete los datos a continuaci√≥n para agregar la motocicleta a la flota',
    moto_info: 'Informaci√≥n de la Moto',
    modelo_label: 'Modelo',
    placa_label: 'Placa',
    status_label: 'Estado (opcional)',
    update_moto: 'Actualizar Moto',
    form_cleared: 'Los campos han sido limpiados. Puedes completar de nuevo.',
    settings_title: 'Configuraciones',
    settings_subtitle: 'Personaliza la apariencia y comportamiento de la app',
    language_label: 'Idioma de la App',
    theme_label: 'Tema de la App',
    appearance: 'Apariencia',
    colors: 'Colores',
    save_changes: 'Guardar cambios',
    logout: 'Salir',
    register: 'Registrar',
    enter: 'Entrar',
    create_account: 'Crear Cuenta',
    fill_data: 'Rellena los datos para registrarte',
    email_label: 'Correo',
    password_label: 'Contrase√±a',
    name_label: 'Nombre Completo',
    confirm_password_label: 'Confirmar Contrase√±a',
    test_notification_title: 'Notificaci√≥n de prueba',
    test_notification_body: '¬°Hola! Esta es una notificaci√≥n de prueba en Espa√±ol.',
    register_success: 'Registrado para notificaciones con √©xito',
    register_fail: 'Error al registrar notificaciones',
  settings_saved: '¬°Configuraciones guardadas!',
  settings_save_fail: 'No se pudieron guardar las configuraciones',
  theme_changed_title: 'Tema cambiado',
  theme_changed_light: '¬°Tema claro aplicado con √©xito!',
  theme_changed_dark: '¬°Tema oscuro aplicado con √©xito!',
  theme_changed_system: '¬°Tema autom√°tico activado - sigue el sistema!',
  colors_presets: 'Colores predefinidos:',
  accent_color_label: 'Color destacado',
  register_notifications: 'Registrar notificaciones',
  push_token_registered: 'Token registrado',
  send_test_notification: 'Enviar notificaci√≥n de prueba',
  loading_moto_data: 'Cargando datos de la moto‚Ä¶',
  plate_format_hint: 'Aseg√∫rate de que la placa tenga el formato correcto (ABC-1234)',
  placeholder_model_examples: 'Ej: Honda CG 160, Yamaha Fazer 250',
  placeholder_plate: 'ABC-1234',
  placeholder_status_examples: 'Disponible, En mantenimiento...',
  theme_light: 'Claro',
  theme_dark: 'Oscuro',
  theme_system: 'Sistema',
  language_selected_pt: 'Portugu√©s seleccionado',
  language_selected_es: 'Espa√±ol seleccionado',
  logout_fail: 'Error al cerrar sesi√≥n. Int√©ntalo de nuevo.',
  test_notification_sent: 'Notificaci√≥n enviada (revisa tu dispositivo)',
  clear_form: 'Limpiar formulario',
  passwords_not_match: 'Las contrase√±as no coinciden',
  password_too_short: 'La contrase√±a debe tener al menos 6 caracteres',
  invalid_email: 'Por favor, introduce un correo v√°lido',
  register_success_message: '¬°Registro realizado con √©xito!',
  already_have_account: '¬øYa tienes una cuenta?',
  login_cta: 'Inicia sesi√≥n',
  no_account: '¬øNo tienes una cuenta?',
  login_fail: 'Error al iniciar sesi√≥n. Verifica tus credenciales.',
  search_title: 'Buscar Motocicleta',
  search_subtitle: 'Ingresa la placa para ver los detalles',
  quick_search_title: 'üöÄ B√∫squeda R√°pida - Motos Disponibles:',
  moto_found_title: '¬°Moto encontrada!',
  moto_loaded_success: 'cargada con √©xito.',
  search_by_plate: 'Consulta por Patente',
  placeholder_plate_search: 'Ingresa la patente (ABC-1234)',
  search_button: 'Buscar Motocicleta',
  reset_search_title: 'B√∫squeda limpia',
  reset_search_message: 'Puedes realizar una nueva b√∫squeda ahora.',
  new_search_label: 'Nueva B√∫squeda',
  label_plate: 'Patente',
  label_patio: 'Patio',
  label_entry_date: 'Fecha de ingreso',
  label_km: 'Kilometraje',
  label_next_maintenance: 'Pr√≥xima Mantenimiento',
  notfound_message: 'Esta pantalla no existe.',
  go_home: 'Ir al inicio',
    about_title: 'Acerca de la App',
    about_commit_label: 'Hash del commit de referencia:',
    about_note: 'Valor obtenido de app.json/package.json/COMMIT_HASH',
    // new keys for motos screens
    'motos.created_success': 'Moto creada con √©xito.',
    'motos.updated_success': 'Moto actualizada con √©xito.',
    'motos.delete_success': 'Moto eliminada con √©xito.',
    'motos.create_fail': 'Error al crear la moto.',
    'motos.update_fail': 'Error al actualizar la moto.',
    'motos.delete_fail': 'Error al eliminar la moto.',
    'buttons.edit': 'Editar',
    'buttons.save': 'Guardar',
    'buttons.delete': 'Eliminar',
    'placeholders.modelo': 'Modelo de la moto',
    'placeholders.placa': 'ABC-1234',
    'placeholders.patio': 'ID del patio',
    'placeholders.km': 'Kilometraje',
    loading_label: 'Cargando...',
  },
  en: {
    error_label: 'Error',
    success_label: 'Success',
    info_label: 'Info',
    load_motos_fail: 'Failed to load motos',
    delete_label: 'Delete',
    delete_confirm: 'Confirm deletion of this moto?',
    cancel_label: 'Cancel',
    delete_fail: 'Failed to delete moto',
    not_found_label: 'Moto not found',
    not_found_message: 'Check the provided key/plate.',
    search_fail: 'Could not search for the moto. Try again.',
    load_moto_fail: 'Failed to load moto',
    data_saved: 'Data saved!',
    save_fail: 'Failed to save',
    edit_moto: 'Edit Moto',
    create_moto: 'Create Moto',
    fill_moto_data: 'Fill the fields below to add the motorcycle to the fleet',
    moto_info: 'Moto Information',
    modelo_label: 'Model',
    placa_label: 'Plate',
    status_label: 'Status (optional)',
    update_moto: 'Update Moto',
    form_cleared: 'Fields cleared. You can fill them again.',
    settings_title: 'Settings',
    settings_subtitle: 'Customize the appearance and behavior of the app',
    language_label: 'App Language',
    theme_label: 'App Theme',
    appearance: 'Appearance',
    colors: 'Colors',
    save_changes: 'Save Changes',
    logout: 'Logout',
    register: 'Register',
    enter: 'Sign in',
    create_account: 'Create Account',
    fill_data: 'Fill the fields to create an account',
    email_label: 'Email',
    password_label: 'Password',
    name_label: 'Full Name',
    confirm_password_label: 'Confirm Password',
    test_notification_title: 'Test notification',
    test_notification_body: 'Hi! This is a test notification in English.',
    register_success: 'Registered for notifications successfully',
    register_fail: 'Failed to register for notifications',
  settings_saved: 'Settings saved!',
  settings_save_fail: 'Could not save settings',
  theme_changed_title: 'Theme Changed',
  theme_changed_light: 'Light theme applied successfully!',
  theme_changed_dark: 'Dark theme applied successfully!',
  theme_changed_system: 'Automatic theme enabled - following system!',
  colors_presets: 'Preset colors:',
  accent_color_label: 'Accent Color',
  register_notifications: 'Register Notifications',
  push_token_registered: 'Token registered',
  send_test_notification: 'Send Test Notification',
  loading_moto_data: 'Loading moto data‚Ä¶',
  plate_format_hint: 'Make sure the plate follows the correct format (ABC-1234)',
  placeholder_model_examples: 'Ex: Honda CG 160, Yamaha Fazer 250',
  placeholder_plate: 'ABC-1234',
  placeholder_status_examples: 'Available, Under maintenance...',
  theme_light: 'Light',
  theme_dark: 'Dark',
  theme_system: 'System',
  language_selected_pt: 'Portuguese selected',
  language_selected_es: 'Spanish selected',
  logout_fail: 'Failed to logout. Please try again.',
  test_notification_sent: 'Notification sent (check your device)',
  clear_form: 'Clear Form',
  passwords_not_match: 'Passwords do not match',
  password_too_short: 'Password must be at least 6 characters',
  invalid_email: 'Please enter a valid email',
  register_success_message: 'Registered successfully!',
  already_have_account: 'Already have an account?',
  login_cta: 'Sign in',
  no_account: 'Don\'t have an account?',
  login_fail: 'Login failed. Check your credentials.',
  search_title: 'Search Motorcycle',
  search_subtitle: 'Enter the plate to view details',
  quick_search_title: 'üöÄ Quick Search - Available Motos:',
  moto_found_title: 'Moto Found!',
  moto_loaded_success: 'loaded successfully.',
  search_by_plate: 'Search by Plate',
  placeholder_plate_search: 'Enter the plate (ABC-1234)',
  search_button: 'Search Motorcycle',
  reset_search_title: 'Search Cleared',
  reset_search_message: 'You can perform a new search now.',
  new_search_label: 'New Search',
  label_plate: 'Plate',
  label_patio: 'Yard',
  label_entry_date: 'Entry Date',
  label_km: 'Mileage',
  label_next_maintenance: 'Next Maintenance',
  notfound_message: "This screen doesn't exist.",
  go_home: 'Go to home',
    about_title: 'About the App',
    about_commit_label: 'Reference commit hash:',
    about_note: 'Value fetched from app.json/package.json/COMMIT_HASH',
    // new keys for motos screens
    'motos.created_success': 'Moto created successfully.',
    'motos.updated_success': 'Moto updated successfully.',
    'motos.delete_success': 'Moto removed successfully.',
    'motos.create_fail': 'Failed to create moto.',
    'motos.update_fail': 'Failed to update moto.',
    'motos.delete_fail': 'Failed to remove moto.',
    'buttons.edit': 'Edit',
    'buttons.save': 'Save',
    'buttons.delete': 'Delete',
    'placeholders.modelo': 'Moto model',
    'placeholders.placa': 'ABC-1234',
    'placeholders.patio': 'Yard ID',
    'placeholders.km': 'Mileage',
    loading_label: 'Loading...',
  },
};

const LANG_KEY = '@FleetZone:lang';

export async function setAppLang(lang: SupportedLang) {
  await AsyncStorage.setItem(LANG_KEY, lang);
}

export async function getAppLang(): Promise<SupportedLang> {
  try {
    const stored = await AsyncStorage.getItem(LANG_KEY);
    if (stored && (stored === 'pt' || stored === 'es' || stored === 'en')) return stored;
  } catch (e) {
    // ignore
  }

  try {
    const locale = Intl?.DateTimeFormat().resolvedOptions().locale ?? 'pt-BR';
    if (locale.startsWith('es')) return 'es';
    if (locale.startsWith('en')) return 'en';
    return 'pt';
  } catch (e) {
    return 'pt';
  }
}

export function t(key: string, lang?: SupportedLang) {
  // sync helper: when lang not supplied use 'pt' as fallback; callers should use getAppLang for async
  const l = lang ?? 'pt';
  return translations[l][key] ?? key;
}

export async function tAsync(key: string) {
  const lang = await getAppLang();
  return translations[lang][key] ?? key;
}

